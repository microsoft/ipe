<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://microsoft.github.io/ipe/usage/events/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Audit Events - Integrity Policy Enforcement</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Integrity Policy Enforcement</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Usage <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../" class="dropdown-item">Overview</a>
</li>
                                    
<li>
    <a href="../properties/" class="dropdown-item">Properties</a>
</li>
                                    
<li>
    <a href="../deployment/" class="dropdown-item">Deploying Policies</a>
</li>
                                    
<li>
    <a href="../examples/" class="dropdown-item">Example Policies</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Audit Events</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Technical <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../technical/threat-model/" class="dropdown-item">Threat Model</a>
</li>
                                    
<li>
    <a href="../../technical/diagrams/" class="dropdown-item">Technical Diagrams</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Other <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../faq/" class="dropdown-item">FAQ</a>
</li>
                                    
<li>
    <a href="../../presentations/" class="dropdown-item">Presentations</a>
</li>
                                    
<li>
    <a href="../../attribution/" class="dropdown-item">Attribution</a>
</li>
                                    
<li>
    <a href="../../license/" class="dropdown-item">License</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../examples/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../../technical/threat-model/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/microsoft/ipe/edit/master/docs/usage/events.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#audit-events" class="nav-link">Audit Events</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#1420-audit_ipe_access" class="nav-link">1420 AUDIT_IPE_ACCESS</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1421-audit_ipe_config_change" class="nav-link">1421 AUDIT_IPE_CONFIG_CHANGE</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1422-audit_ipe_policy_load" class="nav-link">1422 AUDIT_IPE_POLICY_LOAD</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1404-audit_mac_status" class="nav-link">1404 AUDIT_MAC_STATUS</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#success-auditing" class="nav-link">Success Auditing</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="audit-events">Audit Events</h1>
<h2 id="1420-audit_ipe_access">1420 AUDIT_IPE_ACCESS</h2>
<p>Event Examples:</p>
<pre><code>type=1420 audit(1653364370.067:61): ipe_op=EXECUTE ipe_hook=MMAP enforcing=1 pid=2241 comm=&quot;ld-linux.so&quot; path=&quot;/deny/lib/libc.so.6&quot; dev=&quot;sda2&quot; ino=14549020 rule=&quot;DEFAULT action=DENY&quot;
type=1300 audit(1653364370.067:61): SYSCALL arch=c000003e syscall=9 success=no exit=-13 a0=7f1105a28000 a1=195000 a2=5 a3=812 items=0 ppid=2219 pid=2241 auid=0 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=pts0 ses=2 comm=&quot;ld-linux.so&quot; exe=&quot;/tmp/ipe-test/lib/ld-linux.so&quot; subj=unconfined key=(null)
type=1327 audit(1653364370.067:61): 707974686F6E3300746573742F6D61696E2E7079002D6E00

type=1420 audit(1653364735.161:64): ipe_op=EXECUTE ipe_hook=MMAP enforcing=1 pid=2472 comm=&quot;mmap_test&quot; path=? dev=? ino=? rule=&quot;DEFAULT action=DENY&quot;
type=1300 audit(1653364735.161:64): SYSCALL arch=c000003e syscall=9 success=no exit=-13 a0=0 a1=1000 a2=4 a3=21 items=0 ppid=2219 pid=2472 auid=0 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=pts0 ses=2 comm=&quot;mmap_test&quot; exe=&quot;/root/overlake_test/upstream_test/vol_fsverity/bin/mmap_test&quot; subj=unconfined key=(null)
type=1327 audit(1653364735.161:64): 707974686F6E3300746573742F6D61696E2E7079002D6E00
</code></pre>
<p>This event indicates that IPE made an access control decision; the IPE specific record (1420) is always emitted in conjunction with a <code>AUDITSYSCALL</code> record.</p>
<p>Determining whether IPE is in permissive or enforced mode can be derived from <code>success</code> property and exit code of the <code>AUDITSYSCALL</code> record.</p>
<p>Field descriptions:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value Type</th>
<th>Optional?</th>
<th>Description of Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>ipe_op</td>
<td>string</td>
<td>No</td>
<td>The IPE operation name associated with the log</td>
</tr>
<tr>
<td>ipe_hook</td>
<td>string</td>
<td>No</td>
<td>The name of the LSM hook that triggered the IPE event</td>
</tr>
<tr>
<td>enforcing</td>
<td>integer</td>
<td>No</td>
<td>The current IPE enforcing state 1 is in enforcing mode, 0 is in permissive mode</td>
</tr>
<tr>
<td>pid</td>
<td>integer</td>
<td>No</td>
<td>The pid of the process that triggered the IPE event.</td>
</tr>
<tr>
<td>comm</td>
<td>string</td>
<td>No</td>
<td>The command line program name of the process that triggered the IPE event</td>
</tr>
<tr>
<td>path</td>
<td>string</td>
<td>Yes</td>
<td>The absolute path to the evaluated file</td>
</tr>
<tr>
<td>ino</td>
<td>integer</td>
<td>Yes</td>
<td>The inode number of the evaluated file</td>
</tr>
<tr>
<td>dev</td>
<td>string</td>
<td>Yes</td>
<td>The device name of the evaluated file, e.g. vda</td>
</tr>
<tr>
<td>rule</td>
<td>string</td>
<td>No</td>
<td>The matched policy rule</td>
</tr>
</tbody>
</table>
<h2 id="1421-audit_ipe_config_change">1421 AUDIT_IPE_CONFIG_CHANGE</h2>
<p>Event Example:</p>
<pre><code>type=1421 audit(1653425583.136:54): old_active_pol_name=&quot;Allow_All&quot; old_active_pol_version=0.0.0 old_policy_digest=sha256:E3B0C44298FC1C149AFBF4C8996FB92427AE41E4649B934CA495991B7852B855 new_active_pol_name=&quot;boot_verified&quot; new_active_pol_version=0.0.0 new_policy_digest=sha256:820EEA5B40CA42B51F68962354BA083122A20BB846F26765076DD8EED7B8F4DB auid=4294967295 ses=4294967295 lsm=ipe res=1
type=1300 audit(1653425583.136:54): SYSCALL arch=c000003e syscall=1 success=yes exit=2 a0=3 a1=5596fcae1fb0 a2=2 a3=2 items=0 ppid=184 pid=229 auid=4294967295 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=pts0 ses=4294967295 comm=&quot;python3&quot; exe=&quot;/usr/bin/python3.10&quot; key=(null)
type=1327 audit(1653425583.136:54): PROCTITLE proctitle=707974686F6E3300746573742F6D61696E2E7079002D66002E2
</code></pre>
<p>This event indicates that IPE switched the active policy from one to another along with the version and the hash digest of the two policies.
Note IPE can only have one policy active at a time, all access decision evaluation is based on the current active policy.
The normal procedure to deploy a new policy is loading the policy to deploy into the kernel first, then switch the active policy to it.</p>
<p>This record will always be emitted in conjunction with a <code>AUDITSYSCALL</code> record for the <code>write</code> syscall.</p>
<p>Field descriptions:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value Type</th>
<th>Optional?</th>
<th>Description of Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>old_active_pol_name</td>
<td>string</td>
<td>No</td>
<td>The name of previous active policy</td>
</tr>
<tr>
<td>old_active_pol_version</td>
<td>string</td>
<td>No</td>
<td>The version of previous active policy</td>
</tr>
<tr>
<td>old_policy_digest</td>
<td>string</td>
<td>No</td>
<td>The hash of previous active policy</td>
</tr>
<tr>
<td>new_active_pol_name</td>
<td>string</td>
<td>No</td>
<td>The name of current active policy</td>
</tr>
<tr>
<td>new_active_pol_version</td>
<td>string</td>
<td>No</td>
<td>The version of current active policy</td>
</tr>
<tr>
<td>new_policy_digest</td>
<td>string</td>
<td>No</td>
<td>The hash of current active policy</td>
</tr>
<tr>
<td>auid</td>
<td>integer</td>
<td>No</td>
<td>The login user ID</td>
</tr>
<tr>
<td>ses</td>
<td>integer</td>
<td>No</td>
<td>The login session ID</td>
</tr>
<tr>
<td>lsm</td>
<td>string</td>
<td>No</td>
<td>The LSM name associated with the event</td>
</tr>
<tr>
<td>res</td>
<td>integer</td>
<td>No</td>
<td>The result of the audited operation(success/fail)</td>
</tr>
</tbody>
</table>
<h2 id="1422-audit_ipe_policy_load">1422 AUDIT_IPE_POLICY_LOAD</h2>
<p>Event Example:</p>
<pre><code>type=1422 audit(1653425529.927:53): policy_name=&quot;boot_verified&quot; policy_version=0.0.0 policy_digest=sha256:820EEA5B40CA42B51F68962354BA083122A20BB846F26765076DD8EED7B8F4DB auid=4294967295 ses=4294967295 lsm=ipe res=1
type=1300 audit(1653425529.927:53): arch=c000003e syscall=1 success=yes exit=2567 a0=3 a1=5596fcae1fb0 a2=a07 a3=2 items=0 ppid=184 pid=229 auid=4294967295 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=pts0 ses=4294967295 comm=&quot;python3&quot; exe=&quot;/usr/bin/python3.10&quot; key=(null)
type=1327 audit(1653425529.927:53): PROCTITLE proctitle=707974686F6E3300746573742F6D61696E2E7079002D66002E2E
</code></pre>
<p>This record indicates a new policy has been loaded into the kernel with the policy name, policy version and policy hash.</p>
<p>This record will always be emitted in conjunction with a <code>AUDITSYSCALL</code> record for the <code>write</code> syscall.</p>
<p>Field descriptions:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value Type</th>
<th>Optional?</th>
<th>Description of Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>policy_name</td>
<td>string</td>
<td>No</td>
<td>The policy_name</td>
</tr>
<tr>
<td>policy_version</td>
<td>string</td>
<td>No</td>
<td>The policy_version</td>
</tr>
<tr>
<td>policy_digest</td>
<td>string</td>
<td>No</td>
<td>The policy hash</td>
</tr>
<tr>
<td>auid</td>
<td>integer</td>
<td>No</td>
<td>The login user ID</td>
</tr>
<tr>
<td>ses</td>
<td>integer</td>
<td>No</td>
<td>The login session ID</td>
</tr>
<tr>
<td>lsm</td>
<td>string</td>
<td>No</td>
<td>The LSM name associated with the event</td>
</tr>
<tr>
<td>res</td>
<td>integer</td>
<td>No</td>
<td>The result of the audited operation(success/fail)</td>
</tr>
</tbody>
</table>
<h2 id="1404-audit_mac_status">1404 AUDIT_MAC_STATUS</h2>
<p>Event Examples:</p>
<pre><code>type=1404 audit(1653425689.008:55): enforcing=0 old_enforcing=1 auid=4294967295 ses=4294967295 enabled=1 old-enabled=1 lsm=ipe res=1
type=1300 audit(1653425689.008:55): arch=c000003e syscall=1 success=yes exit=2 a0=1 a1=55c1065e5c60 a2=2 a3=0 items=0 ppid=405 pid=441 auid=0 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=)
type=1327 audit(1653425689.008:55): proctitle=&quot;-bash&quot;

type=1404 audit(1653425689.008:55): enforcing=1 old_enforcing=0 auid=4294967295 ses=4294967295 enabled=1 old-enabled=1 lsm=ipe res=1
type=1300 audit(1653425689.008:55): arch=c000003e syscall=1 success=yes exit=2 a0=1 a1=55c1065e5c60 a2=2 a3=0 items=0 ppid=405 pid=441 auid=0 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=)
type=1327 audit(1653425689.008:55): proctitle=&quot;-bash&quot;
</code></pre>
<p>This record will always be emitted in conjunction with a <code>AUDITSYSCALL</code> record for the <code>write</code> syscall.</p>
<p>Field descriptions:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value Type</th>
<th>Optional?</th>
<th>Description of Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>enforcing</td>
<td>integer</td>
<td>No</td>
<td>The enforcing state IPE is being switched to, 1 is in enforcing mode, 0 is in permissive mode</td>
</tr>
<tr>
<td>old_enforcing</td>
<td>integer</td>
<td>No</td>
<td>The enforcing state IPE is being switched from, 1 is in enforcing mode, 0 is in permissive mode</td>
</tr>
<tr>
<td>auid</td>
<td>integer</td>
<td>No</td>
<td>The login user ID</td>
</tr>
<tr>
<td>ses</td>
<td>integer</td>
<td>No</td>
<td>The login session ID</td>
</tr>
<tr>
<td>enabled</td>
<td>integer</td>
<td>No</td>
<td>The new TTY audit enabled setting</td>
</tr>
<tr>
<td>old-enabled</td>
<td>integer</td>
<td>No</td>
<td>The old TTY audit enabled setting</td>
</tr>
<tr>
<td>lsm</td>
<td>string</td>
<td>No</td>
<td>The LSM name associated with the event</td>
</tr>
<tr>
<td>res</td>
<td>integer</td>
<td>No</td>
<td>The result of the audited operation (success/fail)</td>
</tr>
</tbody>
</table>
<h2 id="success-auditing">Success Auditing</h2>
<p>IPE supports success auditing. When enabled, all events that pass IPE policy and are not blocked will emit an audit event. This is disabled by default, and can be enabled via the kernel command line <code>ipe.success_audit=(0|1)</code> or <code>/sys/kernel/security/ipe/success_audit</code> securityfs file.</p>
<p>This is <em>very</em> noisy, as IPE will check every userspace binary on the system, but is useful for debugging policies.</p>
<p><strong>NOTE:</strong></p>
<p>If a traditional MAC system is enabled (SELinux, apparmor, smack, etcetera), all writes to ipe's securityfs nodes require <code>CAP_MAC_ADMIN</code>.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright (c) Microsoft. All rights reserved.</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/jquery-3.6.0.min.js"></script>
        <script src="../../js/bootstrap.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
